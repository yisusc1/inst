<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formularios de Instalación</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.css">
    <style>
        :root {
            --primary-color: #007AFF; --background-color: #f8f9fa; --form-background: #ffffff;
            --text-color: #212529; --label-color: #495057; --border-color: #dee2e6;
            --success-color: #198754; --error-color: #dc3545; --font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        body { font-family: var(--font-family); background-color: var(--background-color); margin: 0; padding: 1rem; }
        .container { max-width: 700px; margin: 2rem auto; background-color: var(--form-background); padding: 2.5rem; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); }
        .nav-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 2rem; justify-content: center; flex-wrap: wrap; }
        .nav-link { padding: 1rem 1.5rem; cursor: pointer; border: none; background: none; font-size: 1rem; color: var(--label-color); border-bottom: 3px solid transparent; }
        .nav-link.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        .form-header { text-align: center; margin-bottom: 2.5rem; }
        h1 { font-size: 1.75rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], input[type="time"], input[type="password"], select, textarea { width: 100%; padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .grid-columns { display: grid; gap: 1.5rem; grid-template-columns: 1fr 1fr; }
        button { padding: 0.9rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:disabled { background-color: #a0c7ff; cursor: not-allowed; }
        .btn-secondary { background-color: #e9ecef; color: var(--text-color); border: 1px solid var(--border-color); }
        .status-message { text-align: center; margin-top: 1rem; font-weight: 500; padding: 0.8rem; border-radius: 8px; }
        .status-message.success { background-color: rgba(25, 135, 84, 0.1); color: var(--success-color); }
        .status-message.error { background-color: rgba(220, 53, 69, 0.1); color: var(--error-color); }
        #admin-board { overflow-x: auto; padding: 20px 0; }
        .kanban-container { display: flex; gap: 20px; align-items: flex-start; }
        .kanban-board { background: #f0f0f0; padding: 10px; border-radius: 8px; min-width: 300px; }
        .kanban-board-header { font-weight: bold; padding: 5px; }
        .kanban-item { background: #fff; padding: 10px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 10px; font-size: 0.9rem; }
        .controls-bar { display: flex; align-items: flex-end; gap: 1rem; flex-wrap: wrap; }
        .board-header-controls { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
        .form-group-inline { display: flex; align-items: center; gap: 1rem; }
    </style>
</head>
<body>

    <nav class="nav-tabs">
        <button class="nav-link active" data-target="#solicitud-panel">Nueva Solicitud</button>
        <button class="nav-link" data-target="#reporte-panel">Reporte Instalación</button>
        <button class="nav-link" data-target="#soporte-panel">Reporte Soporte</button>
        <button class="nav-link" data-target="#admin-panel">Administrador</button>
    </nav>

    <main class="tab-content">
        
        <div id="solicitud-panel" class="tab-pane active">
            <div class="container">
                <div class="form-header"><h1>Nueva Solicitud de Servicio</h1></div>
                <form id="solicitudForm">
                    <input type="hidden" name="formType" value="solicitud">
                    <div class="grid-columns"><div class="form-group"><label for="sol-fecha">Fecha</label><input type="date" id="sol-fecha" name="Fecha" required></div><div class="form-group"><label for="sol-hora">Hora</label><input type="time" id="sol-hora" name="Hora" required></div></div>
                    <div class="form-group"><label for="sol-nombre">Nombre</label><input type="text" id="sol-nombre" name="Nombre" required></div>
                    <div class="form-group"><label for="sol-cedula">Cedula</label><input type="number" id="sol-cedula" name="Cedula" required></div>
                    <div class="form-group"><label for="sol-contacto">Contacto</label><input type="tel" id="sol-contacto" name="Contacto" required></div>
                    <div class="form-group"><label for="sol-contacto2">Contacto2</label><input type="tel" id="sol-contacto2" name="Contacto2"></div>
                    <div class="form-group"><label for="sol-ubicacion">Ubicacion</label><input type="text" id="sol-ubicacion" name="Ubicacion" required></div>
                    <div class="form-group"><label for="sol-municipio">Municipio</label><input type="text" id="sol-municipio" name="Municipio" required></div>
                    <div class="form-group"><label for="sol-sector">Sector</label><input type="text" id="sol-sector" name="Sector" required></div>
                    <div class="form-group"><label for="sol-calle">Calle</label><input type="text" id="sol-calle" name="Calle" required></div>
                    <div class="form-group"><label for="sol-casa">Casa</label><input type="text" id="sol-casa" name="Casa" required></div>
                    <div class="form-group"><label for="sol-email">Email</label><input type="email" id="sol-email" name="Email" required></div>
                    <div class="form-group"><label for="sol-servicio">Servicio</label><input type="text" id="sol-servicio" name="Servicio" required></div>
                    <div class="form-group"><label for="sol-disponibilidad">Disponibilidad</label><input type="date" id="sol-disponibilidad" name="Disponibilidad" required></div>
                    <div class="form-group"><label for="sol-asesor">Asesor</label><input type="text" id="sol-asesor" name="Asesor" required></div>
                    <div class="form-group"><label for="sol-fuente">Fuente</label><input type="text" id="sol-fuente" name="Fuente" required></div>
                    <div class="status-message"></div>
                    <button type="submit" class="btn-primary">Guardar y Enviar</button>
                </form>
            </div>
        </div>

        <div id="reporte-panel" class="tab-pane">
            <div class="container" id="reporte-password-container">
                <div class="form-header"><h1>Acceso Reporte Instalación</h1></div>
                <form id="reporte-password-form"><div class="form-group"><label for="reporte-password">Clave</label><input type="password" id="reporte-password" required></div><button type="submit" class="btn-primary">Ingresar</button></form>
            </div>
            <div class="container" id="reporte-form-container" style="display:none;">
                <div class="form-header"><h1>Reporte de Instalación</h1></div>
                <form id="reporteForm">
                    <input type="hidden" name="formType" value="reporte">
                    </form>
            </div>
        </div>

        <div id="soporte-panel" class="tab-pane">
            <div class="container" id="soporte-password-container">
                <div class="form-header"><h1>Acceso Reporte Soporte</h1></div>
                <form id="soporte-password-form"><div class="form-group"><label for="soporte-password">Clave</label><input type="password" id="soporte-password" required></div><button type="submit" class="btn-primary">Ingresar</button></form>
            </div>
            <div class="container" id="soporte-form-container" style="display:none;">
                <div class="form-header"><h1>Reporte Técnico de Soporte</h1></div>
                <form id="soporteForm">
                    <input type="hidden" name="formType" value="soporte">
                    </form>
            </div>
        </div>

        <div id="admin-panel" class="tab-pane">
            <div class="container" id="admin-password-container">
                <div class="form-header"><h1>Acceso Administrador</h1></div>
                <form id="admin-password-form"><div class="form-group"><label for="admin-password">Clave</label><input type="password" id="admin-password" required></div><button type="submit" class="btn-primary">Ingresar</button></form>
            </div>
            <div id="admin-main-panel" style="display:none;">
                <div class="container">
                    <h1>Planificación del Día</h1>
                    <div class="controls-bar"><div class="form-group"><label for="fecha-planificacion">Fecha</label><input type="date" id="fecha-planificacion"></div><button id="add-equipo-btn" class="btn-primary">➕ Añadir Equipo</button></div>
                </div>
                <div id="admin-board"></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/jkanban@1.3.1/dist/jkanban.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =================================================================
            // URL DEL SCRIPT (¡IMPORTANTE!)
            // =================================================================
            const SCRIPT_URL = 'URL_DE_TU_IMPLEMENTACIÓN_FINAL_AQUÍ';


            // =================================================================
            // LÓGICA DE NAVEGACIÓN POR PESTAÑAS
            // =================================================================
            const navLinks = document.querySelectorAll('.nav-link');
            const tabPanes = document.querySelectorAll('.tab-pane');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.forEach(l => l.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    link.classList.add('active');
                    document.querySelector(link.dataset.target).classList.add('active');
                });
            });


            // =================================================================
            // FUNCIÓN GENÉRICA PARA MANEJAR ENVÍO DE FORMULARIOS
            // =================================================================
            function handleFormSubmit(form, getWhatsAppMessage) {
                form.addEventListener('submit', e => {
                    e.preventDefault();
                    const submitButton = form.querySelector('button[type="submit"]');
                    submitButton.disabled = true;
                    submitButton.textContent = 'Guardando...';
                    
                    const formData = new FormData(form);
                    const whatsappTab = window.open('', '_blank');
                    const message = getWhatsAppMessage(formData);
                    const htmlPreview = message.replace(/\n/g, '<br>');
                    whatsappTab.document.write(`<html><head><title>Vista Previa</title></head><body><p>${htmlPreview}</p><hr><p><i>Guardando...</i></p></body></html>`);

                    fetch(SCRIPT_URL, { method: 'POST', body: formData })
                        .then(res => res.json())
                        .then(data => {
                            if (data.result !== 'success') throw new Error(data.message);
                            whatsappTab.location.href = `https://wa.me/?text=${encodeURIComponent(message)}`;
                            form.reset();
                            alert('Datos guardados con éxito.');
                        })
                        .catch(error => {
                            whatsappTab.close();
                            alert(`Error: ${error.message}`);
                        })
                        .finally(() => {
                            submitButton.disabled = false;
                            submitButton.textContent = 'Guardar y Enviar';
                        });
                });
            }


            // =================================================================
            // LÓGICA FORMULARIO 1: NUEVA SOLICITUD
            // =================================================================
            const solicitudForm = document.getElementById('solicitudForm');
            if(solicitudForm) {
                handleFormSubmit(solicitudForm, (formData) => {
                    // Construir el mensaje de WhatsApp para la solicitud
                    return `*--- Nueva Solicitud de Servicio ---*\n` +
                           `*Fecha:* ${formData.get('Fecha')}\n` +
                           `*Hora:* ${formData.get('Hora')}\n` +
                           `*Nombre:* ${formData.get('Nombre')}`; // ...etc. para todos los campos
                });
            }

            
            // =================================================================
            // LÓGICA FORMULARIO 2: REPORTE INSTALACIÓN
            // =================================================================
            const reporteForm = document.getElementById('reporteForm');
            const reportePasswordForm = document.getElementById('reporte-password-form');
            if(reportePasswordForm) {
                reportePasswordForm.addEventListener('submit', e => {
                    e.preventDefault();
                    if(e.target.querySelector('input').value === '0000') {
                        document.getElementById('reporte-password-container').style.display = 'none';
                        document.getElementById('reporte-form-container').style.display = 'block';
                    } else { alert('Clave incorrecta'); }
                });
            }
            if(reporteForm) {
                handleFormSubmit(reporteForm, (formData) => {
                    // Construir el mensaje de WhatsApp para el reporte
                    return `*Reporte De instalación:*\n` +
                           `*Equipo:* ${formData.get('Equipo') || 'N/A'}`; // ...etc. para todos los campos
                });
            }


            // =================================================================
            // LÓGICA FORMULARIO 3: REPORTE SOPORTE
            // =================================================================
            const soporteForm = document.getElementById('soporteForm');
            const soportePasswordForm = document.getElementById('soporte-password-form');
            if(soportePasswordForm) {
                soportePasswordForm.addEventListener('submit', e => {
                    e.preventDefault();
                    if(e.target.querySelector('input').value === '1111') {
                        document.getElementById('soporte-password-container').style.display = 'none';
                        document.getElementById('soporte-form-container').style.display = 'block';
                        // Auto-llenar fecha y hora
                    } else { alert('Clave incorrecta'); }
                });
            }
            if(soporteForm) {
                // Lógica de geolocalización aquí...

                // Lógica para manejar el envío con imagen (es diferente)
                soporteForm.addEventListener('submit', e => {
                    e.preventDefault();
                    // Lógica completa de FileReader y envío JSON...
                });
            }


            // =================================================================
            // LÓGICA PESTAÑA 4: PANEL DE ADMINISTRADOR
            // =================================================================
            const adminPasswordForm = document.getElementById('admin-password-form');
            if(adminPasswordForm) {
                adminPasswordForm.addEventListener('submit', e => {
                    e.preventDefault();
                    if(e.target.querySelector('input').value === '666') {
                        document.getElementById('admin-password-container').style.display = 'none';
                        document.getElementById('admin-main-panel').style.display = 'block';
                        cargarTecnicosYTablero();
                    } else { alert('Clave incorrecta'); }
                });
            }

            let kanban;
            let tecnicosDisponibles = [];

            function cargarTecnicosYTablero() { /* ... */ }
            function inicializarTablero() { /* ... */ }
            function cargarSolicitudes() { /* ... */ }
            // ... Toda la lógica del panel de administrador que ya desarrollamos ...

        });
    </script>
</body>
</html>
